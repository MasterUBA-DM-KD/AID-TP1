---
title: "Trabajo Práctico 1"
author: "Alejandro Uribe"
lang: es
description: |
  Pruebas paramétricas y no paramétricas
format:
  html:
    page-layout: full
    code-fold: false
    code-line-numbers: true
    code-tools: true
    toc: true
    toc_float: true
    toc-location: left
    css: doc.css
---

# Data

The data is related to direct marketing campaigns of a financial institution.The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to assess if the product (bank term deposit) would be `yes` or not `no` subscribed. You will have to analyze the dataset in order to find ways to look for future strategies in order to improve future marketing campaigns for the bank.

## Attribute Information

### Input Variables

|  #  | Variable    | Type        | Description             | Examples
| --- | ----------- | ----------- | ----------------------- | -----------
|  1  | age         | numeric     |                         |             
|  2  | job         | categorical | type of job             | `admin`, `blue-collar`, `entrepreneur`, `housemaid`, `management`, `retired`, `self-employed`, `services`, `student`, `technician`, `unemployed`, `unknown`
|  3  | marital     | categorical | marital status          | `divorced`\*, `married`, `single`, `unknown`
|  4  | education   | categorical |                         | `basic.4y`, `basic.6y`, `basic.9y`, `high.school`, `illiterate`, `professional.course`, `university.degree`, `unknown`
|  5  | default     | categorical | has credit in default?  | `no`, `yes`, `unknown`
|  6  | balance     | numeric     |                         |               
|  7  | housing     | categorical | has housing loan?       | `no`, `yes`, `unknown`
|  8  | loan        | categorical | has personal loan?      | `no`, `yes`, `unknown`

> \* **Note**  
`divorced` means `divorced` or `widowed`

*Related with the last contact of the current campaign*

|  #  | Variable    | Type        | Description                           | Examples
| --- | ----------- | ----------- | ------------------------------------- | -----------
| 9   | contact     | categorical | contact communication type            | `cellular`, `telephone`
| 10  | month       | categorical | last contact month of year            | `jan`, `feb`, `mar`, ... , `nov`, `dec`
| 11  | day         | categorical | last contact day of the week          | `mon`, `tue`, `wed`, `thu`, `fri`
| 12  | duration    | numeric     | last contact duration, in seconds\*   |

> \* **Note**  
This attribute highly affects the output `target` (e.g., if `duration=0` then `y=no`).  
Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known.  
Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.

*Other attributes*

|  #  | Variable    | Type        | Description                                                                                   | Examples
| --- | ----------- | ----------- | --------------------------------------------------------------------------------------------- | -----------
| 13  | campaign    | numeric     | number of contacts performed during this campaign and for this client                         | Includes last contact
| 14  | pdays       | numeric     | number of days that passed by after the client was last contacted from a previous campaign    | `999` means client was not previously contacted
| 15  | previous    | numeric     | number of contacts performed before this campaign and for this client                         |
| 16  | poutcome    | categorical | outcome of the previous marketing campaign                                                    | `failure`, `nonexistent`, `success`

### Output variable

|  #  | Variable    | Type        | Description                               | Examples
| --- | ----------- | ----------- | ----------------------------------------- | -----------
| 17  | deposit     | binary      | has the client subscribed a term deposit? | `yes`, `no`

# Librerías

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
#styler::tidyverse_style()
#styler::style_dir()
library(splitstackshape)
library(patchwork)
library(ggplot2)
library(plotly)
library(magrittr)
library(dplyr)
library(moments)
library(reactable)
```

```{r set-options, echo=FALSE, cache=TRUE, include=FALSE, results='hide'}
options(width=10000)
options(digits=4)
colFormat(digits=4)
```

------

# Consignas

## 1. Muestra 

Para la base de datos seleccionada genere una muestra aleatoria estratificada y balanceada por "depósito" de tamaño `n = 2000` utilizando como semilla los últimos tres dígitos del DNI/PASAPORTE. Guarde los datos en un archivo y realice todo el trabajo práctico con la muestra generada.

```{r}
n <- 2000
set.seed(108)
```

Se cargan los datos y se toma la muestra estraficada.

```{r}
df <- read.csv("data/training_data.csv")
df <- stratified(df, c("deposit"), n)
```

Se muestra algunas filas de los datos.

```{r}
reactable(head(df))
```

------

## 2. Análisis estadístico

Realice un análisis estadístico de cada una de las variables numéricas para cada valor de depósito. Presente la información en forma tabular y conteniendo las siguientes medidas descriptivas:

* Cantidad de datos
* Mínimo, máximo
* Media, mediana, moda
* Varianza, desviación estándar
* Coeficiente de variación
* Cuartil 1, cuartil 3
* Rango intercuartílico
* MAD
* Asimetría
* Curtosis

Se listan las variables numéricas a fin de analizarlas por separado.

```{r}
numeric_cols <- c("age", "balance", "duration", "campaign", "pdays", "previous")
```

Se listan las variables categóricas a fin de analizarlas por separado.

```{r}
categorical_cols <-
  c(
    "job",
    "marital",
    "education",
    "default",
    "housing",
    "loan",
    "contact",
    "month",
    "day",
    "poutcome"
  )
```

Se creó un subset de los datos con únicamente las variables numéricas.

```{r}
df_numeric <- subset(df, select = numeric_cols)
reactable(head(df_numeric))
```

Se crean dos funciones:

* Obtener la moda
* Calcular los estadísticos faltantes: 
  * Moda
  * Varianza, Desviación estándar
  * Coeficiente de variación
  * Rango intercuartílico
  * MAD
  * Asimetría
  * Curtosis
  * Cantidad de datos

```{r}
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

multiple.func <- function(x) {
  c(MAD = mad(x), 
    Mode= getmode(x), 
    Var=var(x), 
    SD= sd(x), 
    CV = sd(x) / mean(x), 
    IQR= IQR(x), 
    Asimetria=skewness(x), 
    Curtosis=kurtosis(x), 
    Count = length(x))
}
```

Se procedió a calcular los estadísticos de las columnas numéricas.

```{r}
numeric_summary <-
  data.frame(unclass(do.call(cbind, lapply(df_numeric, summary))),
             check.names = FALSE,
             stringsAsFactors = FALSE)
```

Se muestran a continuación los estadísticos.

```{r}
other_stats <- data.frame(lapply(df_numeric, multiple.func))
numeric_summary <- rbind(numeric_summary, other_stats)
reactable(numeric_summary)
```

------

## 3. Análisis gráfico

Represente gráficamente cada variable numérica eligiendo el gráfico que considere apropiado. Considere la posibilidad de generar rangos de datos para su análisis y representación gráfica de las variables.

```{r}
df_numeric$deposit = df$deposit
```

```{r}
p <- df %>%
  ggplot(aes(deposit, balance, )) +
  geom_boxplot(
    outlier.colour = "red",
    outlier.shape = 16,
    outlier.size = 2,
    notch = FALSE
  )

ggplotly(p)
```


```{r}
p <- ggplot( df_numeric, aes(x=duration, color=deposit)) +
    geom_density(alpha=0.8)

ggplotly(p)
```

## 4. Tabla de frecuencias ~ `marital`

Presente una tabla de frecuencias y porcentaje para la variable “marital” (estado civil)
según el nivel de la variable “deposit”.

```{r}
pair <- c("deposit", "marital")
```



```{r}
table_freq <- data.frame(table(subset(df, select= pair)))
reactable(table_freq)
```

```{r}
table_per <- data.frame(table_freq / sum(table_freq))
reactable(table_per)
```



## 5. Gráfico de frecuencias ~ `marital`

Realice un gráfico para representar la tabla construida en el punto 4.

```{r}
barplot(table(subset(df, select= pair)))
```


```{r}


p <- ggplot(data=table_freq, aes(x=marital, y=Freq, fill=deposit)) +
  geom_bar(stat="identity")+
  geom_text(aes(label=len), vjust=1.6, color="white", size=3.5)+
  scale_fill_brewer(palette="Paired")+
  theme_minimal()

ggplotly(p)
```

```{r}
barplot(table_per)
```

## 6. Asociación entre `a` y `b`

Elija dos variables continuas, establezca rangos que representen distintos niveles de cada
una y defina nuevas variables categóricas. Aplique un test adecuado para entender si
existe asociación entre ambas. Utilice un nivel de significación del 5%.

```{r}
alpha <- 0.05
```

```{r}
```


```{r}
```


```{r}
```


7. Seleccione la variable “education” y elija otra variable categórica. Aplique un test
adecuado para entender si existe asociación entre ambas. Utilice un nivel de
significación del 5%.


8. Seleccione otra variable continua y estime la diferencia de medias según el valor de la
variable “deposit” con un nivel de confianza del 95%. Interprete el resultado obtenido.


9. Según el resultado obtenido en el punto 7.- realice un test de hipótesis apropiado para
determinar la diferencia de medias de la variable en estudio. Trabaje con una
significación del 5%. Presente el planteo de hipótesis adecuado, la resolución y la
decisión a tomar.


10. Seleccione una muestra de 30 elementos estratificada según la variable “deposit”. ¿Se
puede afirmar que hay diferencias significativas en el balance de los que realizaron el
depósito respecto a aquellos que no lo hicieron? Elija un test de hipótesis adecuado.
Trabaje con una significación del 5%.


11. Decida si existen diferencias significativas en la duración respecto los niveles de
educación (“secondary”, “tertiary”, “primary”, “unknown”). Justifique. Utilice un test
adecuado. Realice las pruebas necesarias para comprobar los supuestos. Trabaje con
una significación del 5%.


12. Elija dos variables cuantitativas, determine la variable explicativa y la variable explicada.
Encuentre la ecuación de la recta de regresión lineal que explique la relación entre las
variables elegidas. Escriba conclusiones acerca de la significatividad del modelo aplicado.
Puede acompañar el modelo de un gráfico adecuado.


13. Presente un informe final con un mínimo de 500 y un máximo de 800 palabras del
análisis de la base de datos, describiendo la base de datos, indicando la presencia de
valores atípicos y las conclusiones a las que se abordó luego del análisis.


